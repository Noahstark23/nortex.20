// NORTEX INC. - REAL MONEY PROTOCOL SCHEMA
// Expense & B2BOrder models for Real Business Logic

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ==========================================
// CORE BUSINESS ENTITIES
// ==========================================

model Tenant {
  id                   String    @id @default(cuid())
  businessName         String
  taxId                String    @unique
  walletBalance        Decimal   @default(0) @db.Decimal(12, 2)
  creditLimit          Decimal   @default(0) @db.Decimal(12, 2)
  creditScore          Int       @default(0)
  subscriptionStatus   String    @default("TRIAL") // TRIAL | ACTIVE | PAST_DUE | CANCELLED
  stripeCustomerId     String? // Stripe Customer ID (cus_xxx)
  stripeSubscriptionId String? // Stripe Subscription ID (sub_xxx)
  subscriptionEndsAt   DateTime? // Fecha de vencimiento de la suscripci贸n
  theftAlertThreshold  Decimal   @default(500) @db.Decimal(10, 2)
  // Campos Fiscales DGI
  address       String?   // Direcci贸n fiscal
  phone         String?   // Tel茅fono del negocio
  dgiAuthCode   String?   // C贸digo autorizaci贸n DGI (AIMS-xxxx)
  dgiAuthDate   DateTime? // Fecha de autorizaci贸n DGI
  createdAt            DateTime  @default(now())

  users           User[]
  customers       Customer[]
  suppliers       Supplier[]
  employees       Employee[]
  sales           Sale[]
  shifts          Shift[]
  auditLogs       AuditLog[]
  expenses        Expense[]
  b2bOrders       B2BOrder[]
  products        Product[]
  kardexMovements KardexMovement[]
  purchases       Purchase[]
  manualPayments  ManualPayment[]
  quotations      Quotation[]
  invitations     Invitation[]
  cashMovements   CashMovement[]
  productReturns  ProductReturn[]
  accounts        Account[]
  journalEntries  JournalEntry[]
  fiscalRetentions FiscalRetention[]
  invoiceSeries   InvoiceSeries[]

  // HR Module
  leaveRequests         LeaveRequest[]
  payrollRuns           PayrollRun[]
  payrollLines          PayrollLine[]
  salaryAdvances        SalaryAdvance[]
  terminationSettlements TerminationSettlement[]
}

model User {
  id        String    @id @default(cuid())
  tenantId  String
  email     String    @unique
  password  String
  name      String
  role      String    @default("EMPLOYEE") // OWNER, ADMIN, MANAGER, CASHIER, VIEWER
  status    String    @default("ACTIVE") // ACTIVE, DISABLED
  lastLogin DateTime?
  invitedBy String?
  createdAt DateTime  @default(now())

  tenant          Tenant           @relation(fields: [tenantId], references: [id])
  shifts          Shift[]
  payments        Payment[]
  auditLogs       AuditLog[]
  productsCreated Product[]
  kardexMovements KardexMovement[]
  passwordResets  PasswordReset[]
  cashMovements   CashMovement[]
  employeeProfile Employee?

  @@index([tenantId])
}

// ==========================================
// INVITACIONES DE EQUIPO
// ==========================================

model Invitation {
  id        String   @id @default(cuid())
  tenantId  String
  email     String
  role      String   // MANAGER, CASHIER, VIEWER
  token     String   @unique
  status    String   @default("PENDING") // PENDING, ACCEPTED, EXPIRED
  invitedBy String   // userId del que invit贸
  createdAt DateTime @default(now())
  expiresAt DateTime // 48 horas despu茅s de creaci贸n

  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@index([tenantId])
  @@index([token])
}

// ==========================================
// RECUPERACIN DE CONTRASEA
// ==========================================

model PasswordReset {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  used      Boolean  @default(false)
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@index([token])
}

model Customer {
  id          String   @id @default(cuid())
  tenantId    String
  name        String
  taxId       String?
  phone       String?
  email       String?
  address     String?  @db.Text
  creditLimit Decimal  @default(0) @db.Decimal(10, 2)
  currentDebt Decimal  @default(0) @db.Decimal(10, 2)
  isBlocked   Boolean  @default(false)
  createdAt   DateTime @default(now())

  tenant Tenant @relation(fields: [tenantId], references: [id])
  sales  Sale[]

  @@index([tenantId])
}

model Supplier {
  id          String   @id @default(cuid())
  tenantId    String
  name        String
  contactName String?
  phone       String?
  email       String?
  category    String?
  createdAt   DateTime @default(now())

  tenant    Tenant     @relation(fields: [tenantId], references: [id])
  purchases Purchase[]

  @@index([tenantId])
}

// ==========================================
// COMPRAS & CUENTAS POR PAGAR
// ==========================================

model Purchase {
  id            String    @id @default(cuid())
  tenantId      String
  supplierId    String
  invoiceNumber String // # Factura del proveedor
  date          DateTime  @default(now())
  dueDate       DateTime? // Fecha de vencimiento (para cr茅dito)
  subtotal      Decimal   @db.Decimal(12, 2)
  tax           Decimal   @default(0) @db.Decimal(12, 2)
  total         Decimal   @db.Decimal(12, 2)
  status        String    @default("COMPLETED") // COMPLETED | PENDING_PAYMENT
  paymentMethod String // CASH | CREDIT
  notes         String?   @db.Text
  createdBy     String
  createdAt     DateTime  @default(now())

  tenant   Tenant         @relation(fields: [tenantId], references: [id])
  supplier Supplier       @relation(fields: [supplierId], references: [id])
  items    PurchaseItem[]

  @@index([tenantId])
  @@index([supplierId])
  @@index([status])
}

model PurchaseItem {
  id          String  @id @default(cuid())
  purchaseId  String
  productId   String
  productName String // Snapshot del nombre al momento de compra
  quantity    Int
  unitCost    Decimal @db.Decimal(10, 2)
  totalCost   Decimal @db.Decimal(10, 2)

  purchase Purchase @relation(fields: [purchaseId], references: [id], onDelete: Cascade)

  @@index([purchaseId])
}

model Employee {
  id                    String   @id @default(cuid())
  tenantId              String
  userId                String?  @unique // Link a User (para el EmployeeProfile real interactivo)
  firstName             String
  lastName              String
  role                  String
  pin                   String   @default("0000")
  cedula                String? // C茅dula de identidad nicarag眉ense
  inss                  String? // N煤mero INSS del empleado
  baseSalary            Decimal  @db.Decimal(10, 2)
  commissionRate        Decimal  @default(0) @db.Decimal(5, 2)
  phone                 String?
  vacationDays          Float    @default(0) // D铆as de vacaciones acumulados
  accumulatedThirteenth Decimal  @default(0) @db.Decimal(10, 2) // Aguinaldo acumulado
  hireDate              DateTime @default(now())
  bankAccount           String?
  status                String   @default("ACTIVE") // ACTIVE, SUSPENDED, TERMINATED

  tenant   Tenant    @relation(fields: [tenantId], references: [id])
  user     User?     @relation(fields: [userId], references: [id])
  sales    Sale[]
  shifts   Shift[]
  payrolls Payroll[]

  // HR Relations
  leaveRequests         LeaveRequest[]
  salaryAdvances        SalaryAdvance[]
  terminationSettlement TerminationSettlement?
  payrollLines          PayrollLine[]

  @@index([tenantId])
}

// ==========================================
// NMINA NICARAGENSE (LEY 185 CDIGO DEL TRABAJO)
// ==========================================

model Payroll {
  id         String @id @default(cuid())
  tenantId   String
  employeeId String
  month      Int // 1-12
  year       Int

  // Ingresos
  grossSalary Decimal @db.Decimal(10, 2) // Salario Base
  commissions Decimal @default(0) @db.Decimal(10, 2)
  totalIncome Decimal @db.Decimal(10, 2) // Bruto total

  // Deducciones de Ley
  inssLaboral     Decimal @db.Decimal(10, 2) // 7% (INSS Laboral)
  irLaboral       Decimal @db.Decimal(10, 2) // IR seg煤n tabla progresiva DGI
  totalDeductions Decimal @db.Decimal(10, 2)

  // Neto
  netSalary Decimal @db.Decimal(10, 2) // Neto a recibir

  // Aportes Patronales (costo empresa)
  inssPatronal Decimal @db.Decimal(10, 2) // 22.5% (INSS Patronal)
  inatec       Decimal @db.Decimal(10, 2) // 2% (INATEC)

  status    String    @default("PENDIENTE") // PENDIENTE | PAGADO
  paidAt    DateTime?
  createdAt DateTime  @default(now())

  employee Employee @relation(fields: [employeeId], references: [id])

  @@unique([employeeId, month, year])
  @@index([tenantId])
  @@index([employeeId])
}

// ==========================================
// REPORTES FISCALES DGI NICARAGUA
// ==========================================

model TaxReport {
  id       String @id @default(cuid())
  tenantId String
  month    Int
  year     Int

  // Ventas
  totalSales        Decimal @db.Decimal(12, 2)
  totalIVACollected Decimal @db.Decimal(12, 2) // IVA cobrado en ventas
  totalIVAPaid      Decimal @db.Decimal(12, 2) // IVA pagado en compras (cr茅dito fiscal)

  // Impuestos a pagar
  ivaNeto     Decimal @db.Decimal(12, 2) // IVA Ventas - IVA Compras
  anticipoIR  Decimal @db.Decimal(12, 2) // 1% sobre ventas netas
  imiAlcaldia Decimal @db.Decimal(12, 2) // 1% impuesto municipal
  totalToPay  Decimal @db.Decimal(12, 2)

  generatedAt DateTime @default(now())

  @@unique([tenantId, month, year])
  @@index([tenantId])
}

model Sale {
  id            String    @id @default(cuid())
  tenantId      String
  total         Decimal   @db.Decimal(10, 2)
  status        String
  paymentMethod String
  customerName  String?
  customerId    String?
  employeeId    String?
  balance       Decimal   @default(0) @db.Decimal(10, 2)
  dueDate       DateTime?
  shiftId       String?
  createdAt     DateTime  @default(now())
  globalDiscount Float     @default(0)
  // Facturaci贸n DGI
  invoiceNumber  Int?      // Consecutivo controlado (1, 2, 3...)
  invoiceSeries  String?   // Serie: "A", "B" (por sucursal)

  tenant   Tenant     @relation(fields: [tenantId], references: [id])
  customer Customer?  @relation(fields: [customerId], references: [id])
  employee Employee?  @relation(fields: [employeeId], references: [id])
  shift    Shift?     @relation(fields: [shiftId], references: [id])
  items    SaleItem[]
  payments Payment[]
  productReturns ProductReturn[]

  @@index([tenantId])
  @@index([customerId])
  @@index([employeeId])
  @@index([shiftId])
}

model SaleItem {
  id          String  @id @default(cuid())
  saleId      String
  productId   String
  quantity    Float
  priceAtSale Decimal @db.Decimal(10, 2)
  costAtSale  Decimal @db.Decimal(10, 2)
  discount    Float   @default(0) // Item discount percentage (0-100)

  sale Sale @relation(fields: [saleId], references: [id])

  @@index([saleId])
}

model Payment {
  id          String   @id @default(cuid())
  saleId      String
  amount      Decimal  @db.Decimal(10, 2)
  method      String
  collectedBy String
  createdAt   DateTime @default(now())

  sale Sale @relation(fields: [saleId], references: [id])
  user User @relation(fields: [collectedBy], references: [id])

  @@index([saleId])
}

model Shift {
  id                 String    @id @default(cuid())
  tenantId           String
  userId             String
  employeeId         String? // Empleado que abri贸 la caja (PIN)
  initialCash        Decimal   @db.Decimal(10, 2)
  finalCashDeclared  Decimal?  @db.Decimal(10, 2)
  systemExpectedCash Decimal?  @db.Decimal(10, 2)
  difference         Decimal?  @db.Decimal(10, 2)
  regularHours       Float     @default(0)
  overtimeHours      Float     @default(0)
  nightHours         Float     @default(0)
  status             String
  startTime          DateTime  @default(now())
  endTime            DateTime?

  tenant        Tenant         @relation(fields: [tenantId], references: [id])
  user          User           @relation(fields: [userId], references: [id])
  employee      Employee?      @relation(fields: [employeeId], references: [id])
  sales         Sale[]
  cashMovements CashMovement[]

  @@index([tenantId])
  @@index([userId])
  @@index([employeeId])
}

model Expense {
  id          String   @id @default(cuid())
  tenantId    String
  amount      Decimal  @db.Decimal(12, 2)
  description String   @db.Text
  category    String
  createdAt   DateTime @default(now())

  tenant       Tenant        @relation(fields: [tenantId], references: [id])
  cashMovement CashMovement?

  @@index([tenantId])
  @@index([category])
}

// ==========================================
//  CASH MOVEMENTS (ENTRADAS/SALIDAS DE CAJA)
// ==========================================

model CashMovement {
  id          String    @id @default(cuid())
  tenantId    String
  shiftId     String
  userId      String
  type        String    // IN | OUT
  amount      Decimal   @db.Decimal(10, 2)
  currency    String    @default("NIO") // NIO | USD
  category    String    // GASTO_OPERATIVO | PAGO_PROVEEDOR | RETIRO_PERSONAL | CAMBIO | INYECCION_CAPITAL | AJUSTE
  description String    @db.Text
  expenseId   String?   @unique // Auto-linked Expense (for OUT movements)
  isVoided    Boolean   @default(false) // Soft delete: movimiento anulado
  voidReason  String?   @db.Text
  voidedAt    DateTime?
  voidedBy    String?
  createdAt   DateTime  @default(now())

  tenant  Tenant   @relation(fields: [tenantId], references: [id])
  shift   Shift    @relation(fields: [shiftId], references: [id])
  user    User     @relation(fields: [userId], references: [id])
  expense Expense? @relation(fields: [expenseId], references: [id])

  @@index([tenantId])
  @@index([shiftId])
  @@index([createdAt])
}

model B2BOrder {
  id        String   @id @default(cuid())
  tenantId  String
  total     Decimal  @db.Decimal(12, 2)
  items     Json
  status    String
  createdAt DateTime @default(now())

  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@index([tenantId])
}

model AuditLog {
  id        String   @id @default(cuid())
  tenantId  String
  userId    String
  action    String
  details   String?  @db.Text
  createdAt DateTime @default(now())

  tenant Tenant @relation(fields: [tenantId], references: [id])
  user   User   @relation(fields: [userId], references: [id])

  @@index([tenantId])
  @@index([userId])
}

// ==========================================
// INVENTORY MANAGEMENT (Professional Kardex System)
// ==========================================

model Product {
  id       String @id @default(cuid())
  tenantId String

  // Identificaci贸n
  name        String
  sku         String // C贸digo 煤nico del producto
  description String? @db.Text
  category    String?

  // Precios
  price Float // Precio de venta
  cost  Float // Costo de compra

  // Inventario
  stock    Float  @default(0)
  minStock Float  @default(0) // Stock m铆nimo para alerta
  unit     String @default("unidad") // kg, litro, unidad, caja, etc.

  // Auditor铆a
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String

  // Relaciones
  tenant          Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator         User             @relation(fields: [createdBy], references: [id])
  kardexMovements KardexMovement[]

  @@unique([tenantId, sku])
  @@index([tenantId])
  @@index([category])
}

model KardexMovement {
  id       String @id @default(cuid())
  tenantId String

  // Producto afectado
  productId String

  // Tipo de movimiento
  type     String // IN (entrada), OUT (salida), SALE (venta), ADJUSTMENT (ajuste), RETURN (devoluci贸n)
  quantity Float // Cantidad (positiva para entradas, negativa para salidas)

  // Stock antes/despu茅s para auditor铆a
  stockBefore Float
  stockAfter  Float

  // Referencia opcional (ID de venta, compra, etc.)
  referenceId   String?
  referenceType String? // SALE, PURCHASE, ADJUSTMENT, INITIAL

  // Auditor铆a
  reason String?  @db.Text
  date   DateTime @default(now())
  userId String

  // Relaciones
  tenant  Tenant  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id])

  @@index([productId])
  @@index([tenantId])
  @@index([date])
  @@index([type])
}

// ==========================================
// PAGOS MANUALES (DEPSITO / TRANSFERENCIA)
// ==========================================

model ManualPayment {
  id              String    @id @default(cuid())
  tenantId        String
  amount          Decimal   @db.Decimal(10, 2)
  currency        String    @default("USD") // USD | NIO
  bank            String // Banco destino (BAC, Lafise, etc.)
  referenceNumber String // N煤mero de referencia del voucher
  proofUrl        String?   @db.Text // URL/ruta de la foto del comprobante
  notes           String?   @db.Text
  status          String    @default("PENDING") // PENDING | APPROVED | REJECTED
  rejectionReason String?   @db.Text
  reviewedBy      String? // userId del admin que revis贸
  reviewedAt      DateTime?
  createdAt       DateTime  @default(now())

  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@index([tenantId])
  @@index([status])
}

// ==========================================
// QUOTATIONS (COTIZACIONES)
// ==========================================

model Quotation {
  id           String   @id @default(cuid())
  tenantId     String
  customerName String
  customerRuc  String?
  subtotal     Decimal  @db.Decimal(10, 2)
  tax          Decimal  @db.Decimal(10, 2)
  total        Decimal  @db.Decimal(10, 2)
  status       String   @default("SENT") // SENT | CONVERTED | EXPIRED
  createdAt    DateTime @default(now())
  expiresAt    DateTime

  tenant Tenant          @relation(fields: [tenantId], references: [id])
  items  QuotationItem[]

  @@index([tenantId])
}

model QuotationItem {
  id          String  @id @default(cuid())
  quotationId String
  productId   String
  quantity    Int
  price       Decimal @db.Decimal(10, 2)
  name        String // Snapshot name

  quotation Quotation @relation(fields: [quotationId], references: [id], onDelete: Cascade)

  @@index([quotationId])
}

// ==========================================
//  DEVOLUCIONES / NOTAS DE CRDITO
// ==========================================

model ProductReturn {
  id        String   @id @default(cuid())
  tenantId  String
  saleId    String
  total     Decimal  @db.Decimal(10, 2) // Total del reembolso
  reason    String   @db.Text
  items     Json     // [{productId, name, quantity, price}]
  createdBy String
  createdAt DateTime @default(now())

  tenant Tenant @relation(fields: [tenantId], references: [id])
  sale   Sale   @relation(fields: [saleId], references: [id])

  @@index([tenantId])
  @@index([saleId])
}

// ==========================================
//  CONTABILIDAD DE PARTIDA DOBLE (NIIF PyMES)
// ==========================================

model Account {
  id       String  @id @default(cuid())
  tenantId String
  code     String  // "1.1.1", "4.1.1", etc.
  name     String  // "Caja General", "Inventario", "Ventas"
  type     String  // ASSET, LIABILITY, EQUITY, REVENUE, EXPENSE
  subtype  String? // CURRENT_ASSET, FIXED_ASSET, CURRENT_LIABILITY, etc.
  balance  Decimal @default(0) @db.Decimal(14, 2)
  isSystem Boolean @default(true) // Cuentas del sistema (no borrables)

  tenant Tenant        @relation(fields: [tenantId], references: [id])
  lines  JournalLine[]

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([type])
}

model JournalEntry {
  id            String   @id @default(cuid())
  tenantId      String
  date          DateTime @default(now())
  description   String   @db.Text
  referenceId   String?  // Sale.id, Purchase.id, etc.
  referenceType String?  // SALE, PURCHASE, EXPENSE, PAYROLL, ADJUSTMENT, RETURN, PAYMENT
  isAutomatic   Boolean  @default(true)
  createdBy     String
  createdAt     DateTime @default(now())

  tenant Tenant        @relation(fields: [tenantId], references: [id])
  lines  JournalLine[]

  @@index([tenantId])
  @@index([referenceId])
  @@index([date])
}

model JournalLine {
  id             String  @id @default(cuid())
  journalEntryId String
  accountId      String
  debit          Decimal @default(0) @db.Decimal(14, 2)
  credit         Decimal @default(0) @db.Decimal(14, 2)

  entry   JournalEntry @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)
  account Account      @relation(fields: [accountId], references: [id])

  @@index([journalEntryId])
  @@index([accountId])
}

model FiscalRetention {
  id          String   @id @default(cuid())
  tenantId    String
  type        String   // IR_2PCT, IMI_1PCT, IVA_RETENIDO
  amount      Decimal  @db.Decimal(10, 2)
  baseAmount  Decimal  @db.Decimal(10, 2)
  supplierId  String?
  purchaseId  String?
  description String   @db.Text
  period      String   // "2026-02"
  createdAt   DateTime @default(now())

  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@index([tenantId])
  @@index([period])
}

// ==========================================
// Ь FACTURACIN COMPUTARIZADA DGI
// ==========================================

model InvoiceSeries {
  id         String  @id @default(cuid())
  tenantId   String
  series     String  @default("A") // Serie de factura (A, B, etc.)
  lastNumber Int     @default(0)    // ltimo consecutivo emitido
  rangeStart Int     @default(1)    // Rango autorizado DGI: desde
  rangeEnd   Int     @default(999999) // Rango autorizado DGI: hasta
  isActive   Boolean @default(true)

  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@unique([tenantId, series])
  @@index([tenantId])
}

// ==========================================
// HR: NICALABOR ENGINE & MICRO-LENDING
// ==========================================

model LeaveRequest {
  id         String   @id @default(cuid())
  tenantId   String
  employeeId String
  type       String   // SICK, VACATION, UNPAID, MATERNITY
  startDate  DateTime
  endDate    DateTime
  status     String   @default("PENDING") // PENDING, APPROVED, REJECTED
  
  tenant     Tenant   @relation(fields: [tenantId], references: [id])
  employee   Employee @relation(fields: [employeeId], references: [id])

  @@index([tenantId])
  @@index([employeeId])
}

model PayrollRun {
  id          String   @id @default(cuid())
  tenantId    String
  periodStart DateTime
  periodEnd   DateTime
  totalAmount Decimal  @default(0) @db.Decimal(10, 2)
  status      String   @default("DRAFT") // DRAFT, APPROVED, PAID
  
  tenant       Tenant        @relation(fields: [tenantId], references: [id])
  payrollLines PayrollLine[]

  @@index([tenantId])
}

model PayrollLine {
  id                 String   @id @default(cuid())
  tenantId           String
  payrollRunId       String
  employeeId         String
  basePay            Decimal  @db.Decimal(10, 2)
  overtimePay        Decimal  @default(0) @db.Decimal(10, 2)
  commissions        Decimal  @default(0) @db.Decimal(10, 2)
  bonuses            Decimal  @default(0) @db.Decimal(10, 2)
  inssDeduction      Decimal  @default(0) @db.Decimal(10, 2)
  irDeduction        Decimal  @default(0) @db.Decimal(10, 2)
  advanceDeductions  Decimal  @default(0) @db.Decimal(10, 2)
  netPay             Decimal  @db.Decimal(10, 2)

  tenant       Tenant       @relation(fields: [tenantId], references: [id])
  payrollRun   PayrollRun   @relation(fields: [payrollRunId], references: [id])
  employee     Employee     @relation(fields: [employeeId], references: [id])
  advancesPaid SalaryAdvance[]

  @@index([tenantId])
  @@index([payrollRunId])
  @@index([employeeId])
}

model SalaryAdvance {
  id                 String   @id @default(cuid())
  tenantId           String
  employeeId         String
  amount             Decimal  @db.Decimal(10, 2)
  fee                Decimal  @default(0) @db.Decimal(10, 2)
  status             String   @default("PENDING") // PENDING, APPROVED, REJECTED, DEDUCTED
  repaymentPayrollId String?

  tenant             Tenant   @relation(fields: [tenantId], references: [id])
  employee           Employee @relation(fields: [employeeId], references: [id])
  repaymentPayroll   PayrollLine? @relation(fields: [repaymentPayrollId], references: [id])

  @@index([tenantId])
  @@index([employeeId])
  @@index([repaymentPayrollId])
}

model TerminationSettlement {
  id              String   @id @default(cuid())
  tenantId        String
  employeeId      String   @unique
  terminationDate DateTime
  reason          String   // RESIGNATION, DISMISSAL, JUSTIFIED
  aguinaldoAmount Decimal  @default(0) @db.Decimal(10, 2)
  vacationAmount  Decimal  @default(0) @db.Decimal(10, 2)
  severanceAmount Decimal  @default(0) @db.Decimal(10, 2)
  totalAmount     Decimal  @default(0) @db.Decimal(10, 2)

  tenant          Tenant   @relation(fields: [tenantId], references: [id])
  employee        Employee @relation(fields: [employeeId], references: [id])

  @@index([tenantId])
}
